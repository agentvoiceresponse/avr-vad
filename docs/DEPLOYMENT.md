# Deployment and CI/CD

This project uses GitHub Actions to automate testing and npm publishing.

## 🚀 Automated Publishing Pipeline

### NPM Token Configuration

To enable automatic publishing to npm, you need to configure an NPM token in your GitHub repository settings:

1. **Generate an NPM Token:**
   ```bash
   npm login
   npm token create --type=automation
   ```

2. **Add the token to GitHub Secrets:**
   - Go to `Settings` → `Secrets and variables` → `Actions`
   - Click `New repository secret`
   - Name: `NPM_TOKEN`
   - Value: the token generated in step 1

### How the Pipeline Works

#### 📋 Test Pipeline (`test.yml`)
Triggers on:
- Pull requests to `master`, `main`, or `develop`
- Pushes to branches other than `master` and `main`

Executes:
- ✅ Linting with ESLint
- ✅ Testing with Jest
- ✅ TypeScript build
- ✅ Build output verification

#### 🚀 Publishing Pipeline (`publish.yml`)
Triggers on:
- Push to `master` or `main`

Executes:
1. **Complete tests** on Node.js 18.x and 20.x
2. **Version check** - verifies if the version in `package.json` has changed
3. **Automatic publishing** to npm (only if version has changed)
4. **GitHub release** with automatic release notes

## 📦 Release Workflow

### 1. Development
```bash
# Work on a feature branch
git checkout -b feature/new-functionality
# ... development ...
git commit -m "feat: add new functionality"
git push origin feature/new-functionality
```

### 2. Pull Request
- Create a PR to `master`
- Test pipeline runs automatically
- Verify all tests pass

### 3. Release
```bash
# Before merging, update the version
npm version patch  # or minor, major
git push origin master
```

### 4. Automatic Publishing
- Merge to `master` triggers the publishing pipeline
- If the version has changed, the library is published automatically
- A GitHub release is created with release notes

## 🏷️ Versioning

Use [Semantic Versioning](https://semver.org/):

```bash
# Patch (1.0.0 → 1.0.1) - bug fixes
npm version patch

# Minor (1.0.0 → 1.1.0) - new features
npm version minor

# Major (1.0.0 → 2.0.0) - breaking changes
npm version major
```

## 🔍 Monitoring

### Pipeline Status
- 🟢 **Success**: All tests pass
- 🔴 **Failed**: One or more steps fail
- 🟡 **Pending**: Pipeline running

### Logs
You can view detailed logs in the `Actions` section of your GitHub repository.

### Notifications
GitHub sends email notifications for:
- Failed pipelines
- Successful publications
- New releases

## 🛠️ Advanced Configuration

### Environment Variables
You can add environment variables in GitHub Secrets:

- `NPM_TOKEN`: Token for npm publishing (required)
- `GITHUB_TOKEN`: Automatically generated by GitHub

### Branch Protection
We recommend configuring branch protection for `master`:

1. Go to `Settings` → `Branches`
2. Add rule for `master`
3. Enable:
   - ✅ Require status checks to pass
   - ✅ Require pull request reviews
   - ✅ Restrict pushes

## 📞 Troubleshooting

### Pipeline Fails
1. Check logs in the Actions section
2. Verify all tests pass locally:
   ```bash
   npm run lint
   npm test
   npm run build
   ```

### Publishing Doesn't Work
1. Verify `NPM_TOKEN` is configured correctly
2. Check that the version in `package.json` has been updated
3. Verify npm token permissions

### Release Not Created
1. Check that `GITHUB_TOKEN` has the necessary permissions
2. Verify the tag doesn't already exist 